<div>

<div style="display:none;"><?=$propertyID ?></div>

<?php

 $imgQuery = Db::select( "SELECT * FROM expedia_expediaimport_images WHERE property_id = $propertyID AND poster = 1 ORDER BY links_large_sort_id ASC");



// Program to display URL of current page. 
  
if(isset($_SERVER['HTTPS']) && $_SERVER['HTTPS'] === 'on') 
    $link = "https"; 
else
    $link = "http"; 
  
// Here append the common URL characters. 
$link .= "://"; 
  
// Append the host(domain name, ip) to the URL. 
$link .= $_SERVER['HTTP_HOST']; 
  
// Append the requested resource location to the URL 
$link .= $_SERVER['REQUEST_URI']; 
      
// Print the link 
//echo $link; 


?>
</div>




<div class="container" style="padding:0px;margin:0px;width:100%;background:#cfcfcf;margin-bottom: 20px;">

 	
    	<div id="reorderHelper" class="light_box" style="display:none;">1. Drag photos to reorder.<br>2. Click 'Save Reordering' when finished.</div>
        

        <div class="gallery">
        	<ul class="reorder_ul reorder-photos-list">
        		<?php foreach($imgQuery as $value): ?>
	        <!-- <div class="custom-control custom-checkbox image-checkbox">
	            <label class="custom-control-label" for="ck_<?= $value->id ?>">
	                <img src="/vr3/storage/app/media/properties/<?= $propertyID ?>/<?= $value->newname ?>" alt="#" class="img-fluid">
	            </label>
	        </div> -->
		        <li id="image_li_<?= $value->id ?>" class="ui-sortable-handle" style="background: url('https://expedia-properties.s3-ap-southeast-2.amazonaws.com/media/properties/<?= $propertyID ?>/<?= $value->newname ?>');">
	                <a href="javascript:void(0);" style="float:none;" class="image_link">
	                    <!-- <img src="https://expedia-properties.s3-ap-southeast-2.amazonaws.com/media/properties/<?= $propertyID ?>/<?= $value->newname ?>" alt="#" class="img-fluid"> -->
	                </a>
	            </li>

	        	<?php $sorted[] = $value->newname;?>
				<?php endforeach; ?>
	    	</ul>
	    </div>



</div>




<!-- Preview header here -->

<?php if(!empty($sorted[0])):?>
<div id="showroom" style="margin-bottom: 50px;">
	<div class="container" style="padding:0px;margin:0px;width:100%;">
		<div class="row" style="height: 514px;margin:0px;">
			<div class="col-sm-6" style="padding: 0px;overflow: hidden">
				<img src="https://expedia-properties.s3-ap-southeast-2.amazonaws.com/media/properties/<?= $propertyID ?>/<?= $sorted[0]; ?>" alt="#" class="img-fluid" style="max-height: 514px;">
			</div>
			<div class="col-sm-6" style="padding: 0px;overflow: hidden;">
				
					<div class="row" style="margin:0; height: 514px">
            <?php for($cnt = 1; $cnt <= 4; $cnt++): ?>
              <?php if(!empty($sorted[$cnt])): ?>
    						<div class="col-sm-6 tile" style="padding: 0px; background-image: url('https://expedia-properties.s3-ap-southeast-2.amazonaws.com/media/properties/<?= $propertyID ?>/<?= $sorted[$cnt]; ?>'); ">
                 <!--  <img src="https://expedia-properties.s3-ap-southeast-2.amazonaws.com/media/properties/<?= $propertyID ?>/<?= $sorted[$cnt]; ?>" alt="#" class="img-fluid" style="max-height: 257px;"> -->
                </div>
                <?php else: ?>
                <div class="col-sm-6" style="padding: 0px;">
                  <img src="https://place-hold.it/320x257/#ECF0F.jpg" />               
                </div>
              <?php endif; ?>
            <?php endfor;?>
						
					</div>
				
			</div>
		</div>
	</div>	
</div>

<?php endif; ?>



<style>
.img_box {
	/*border:1px solid #ccc;
	*/
	max-width: 252px;

	
}

.img_box img {
	
}


 .custom-control img {
 	max-width: 250px;
 }
.custom-control.image-checkbox {
  position: relative;
  padding-left: 0;
}

.custom-control.image-checkbox .custom-control-input:checked ~ .custom-control-label:after, .custom-control.image-checkbox .custom-control-input:checked ~ .custom-control-label:before {
  opacity: 1;
}

.custom-control.image-checkbox label {
  cursor: pointer;
  position: unset !important;
}

.custom-control.image-checkbox label:before {
  border-color: #007bff;
  background-color: #007bff;
}

.custom-control.image-checkbox label:after, .custom-control.image-checkbox label:before {
  transition: opacity .3s ease;
  opacity: 0;
  left: .25rem;
}

.custom-control.image-checkbox label:focus, .custom-control.image-checkbox label:hover {
  opacity: .8;
}

.custom-control.image-checkbox label img {
  border-radius: 2.5px;
}

.form-group-image-checkbox.is-invalid label {
  color: #dc3545;
}

.form-group-image-checkbox.is-invalid .invalid-feedback {
  display: block;
}



/* image gallery */
.gallery{
    width:100%;
    float:left;
    /*margin-top:15px;*/
    display: flex;
    justify-content: center;
}
.gallery ul{
    margin:0;
    padding:0;
    list-style-type:none;
    display: flex;
    flex-wrap: wrap;
}
.gallery ul li{
   /* padding:7px;*/
    border:2px solid #ffffff;
    float:left;
    margin:10px 7px;
    background-size:cover !important;
    background-repeat: no-repeat;
    width:auto;
    height:auto;
    min-width: 240px;
    min-height: 150px;
    max-height: 150px;
}
.gallery img{
   max-width:220px;
   /*max-height: 140px;*/
}

.tile {
  height: 257px;
  background-position: center center;
  background-size: cover;
  background-repeat: no-repeat;
}

</style>


<script src="https://ajax.googleapis.com/ajax/libs/jqueryui/1.12.1/jquery-ui.min.js"></script>


<script>
	$(document).ready(function(){
    $('.reorder_link').on('click',function(){
    	$("#saveReorderNow").show();
        $("ul.reorder-photos-list").sortable({ tolerance: 'pointer' });
        //$('.reorder_link').html('Save reordering');
        //$('.reorder_link').attr("id","saveReorder");
        $(this).hide();
        $('#reorderHelper').slideDown('slow');
        $('.image_link').attr("href","javascript:void(0);");
        $('.image_link').css("cursor","move");
        
        $("#saveReorder").click(function( e ){
            if( !$("#saveReorder i").length ){
                //$(this).html('').prepend('<img src="images/refresh-animated.gif"/>');
                /*$("ul.reorder-photos-list").sortable('destroy');
                $("#reorderHelper").html("Reordering Photos - This could take a moment. Please don't navigate away from this page.").removeClass('light_box').addClass('notice notice_error');
                
                var h = [];
                $("ul.reorder-photos-list li").each(function() {
                    h.push($(this).attr('id').substr(9));
                });
                */
         
                return false;
            }	
            e.preventDefault();
        });
    });
});


	/*$.request('onUpdateOrder', {
		confirm: 'Are you sure?',
    	redirect: '/dashboard'
	})*/
	$("#saveReorderNow").click(function( e ){


		 $("ul.reorder-photos-list").sortable('destroy');
         //$("#reorderHelper").html("Reordering Photos - This could take a moment. Please don't navigate away from this page.").removeClass('light_box').addClass('notice notice_error');



		var h = [];
        $("ul.reorder-photos-list li").each(function() {
            h.push($(this).attr('id').substr(9));
            //console.log(h);
        });


		$.request('onUpdateOrder', {
			data: { ids: h , pid: <?= $propertyID ?>},		
		    success: function() {
		    	//$("#reorderHelper").delay(5000).fadeOut();
          $("#saveReorder").show();
           $("#reorderHelper").hide();
          $(this).hide();
          $("ul.reorder-photos-list").sortable('destroy');
          $("#showroom").load(" #showroom");
		        //console.log(ids);
		    }
		})

		e.preventDefault();
	});

	

</script>
